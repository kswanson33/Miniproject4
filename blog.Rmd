---
title: "Code goes here"
author: "Kendra Swanson, Margaret Perry"
date: "April 30, 2017"
output: html_document
---

```{r}
library(tidyverse)
library(macleish)
library(rvest)
library(rgdal)
library(rgeos)
```

```{r}
names(macleish_layers)
```

```{r}
##Getting trail data
url1 <- "http://www.mass.gov/anf/research-and-tech/it-serv-and-support/application-serv/office-of-geographic-information-massgis/datalayers/dcrtrails.html"
download.file(url1, destfile = basename(url1))
unzip("dcrtrails.zip", exdir = "dcrtrails")
```

```{r}
trails <- path.expand("dcrtrails")
#ogrListLayers(trails)
```

```{r}
dcr_trails <- readOGR(trails, "DCR_ROADS_TRAILS_ARC")
#summary(dcr_trails)
```

```{r}
##Getting college data
url_colleges<- "http://www.mass.gov/anf/research-and-tech/it-serv-and-support/application-serv/office-of-geographic-information-massgis/datalayers/colleges.html"
download.file(url_colleges, destfile = basename(url_colleges))
unzip("colleges.zip", exdir = "colleges")
```

```{r}
colleges <- path.expand("colleges")
#ogrListLayers(colleges)
```

```{r}
colleges_loc<- readOGR(colleges, "COLLEGES_PT")
#summary(colleges_loc)
```

```{r}
##Getting contour data
url_contour <- "http://www.mass.gov/anf/research-and-tech/it-serv-and-support/application-serv/office-of-geographic-information-massgis/datalayers/hp250k.html"
download.file(url_contour, destfile = basename(url_contour))
unzip("contours250k.zip", exdir = "contours")
```

```{r}
contours <- path.expand("contours")
#ogrListLayers(contours)
```

```{r}
contour_mass<- readOGR(contours, "CONTOURS250K_ARC")
#summary(contour_mass)
```

```{r}
##Transforming to coordinates that work in leaflet
dcr_trails <- spTransform(dcr_trails, CRS("+init=epsg:4326"))
contour_mass <- spTransform(contour_mass, CRS("+init=epsg:4326"))
colleges_loc <- spTransform(colleges_loc, CRS("+init=epsg:4326"))
```

```{r}
##Demonstration
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addMarkers(data = colleges_loc)
```

```{r}
boundary = spTransform(macleish_layers[["boundary"]], CRS("+init=epsg:4326"))
```

```{r}
##Reducing shapefiles to only the data we need
contour_intersect <- gIntersection(boundary, contour_mass)
```

```{r}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addPolylines(data = contour_intersect)
```

```{r}
library(sp)
coords <- rbind(c(42.458299, -72.710239),
                c(42.457476, -72.605017),
                c(42.316596, -72.601298),
                c(42.312746, -72.709123),
                c(42.458299, -72.710239)) %>%
  as.data.frame() %>%
  rename(lat = V1, lon = V2)

#P1 <- Polygon(coords)
#Ps1 <- SpatialPolygons(list(Polygons(list(P1), ID = "a")))
#proj4string(Ps1) <- CRS("+init=epsg:4326")
#proj4string=CRS("+init=espg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))
```

```{r}
polygon <- coords %>%
  select(lon,lat) %>%
  Polygon()
```

```{r}
sp_polygon <- SpatialPolygons(list(Polygons(list(polygon), ID = "a")))
```

```{r}
proj4string(sp_polygon) <- CRS("+init=epsg:4326")
```


```{r}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addPolylines(data = sp_polygon)
```

```{r}
contours_relevant <- gIntersection(sp_polygon, contour_mass)
```

```{r}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addPolylines(data = contours_relevant)
```

```{r}
trails_relevant <- gIntersection(Ps1, dcr_trails)
```

